<meta name="viewport" content="initial-scale=1,user-scalable=no">

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<title>FirePad</title>
<style>
body{color;black;background:whitesmoke;}
#fire{font-size:large; background:none;width:100%;height:100%;border:0;white-space:pre-wrap;}

h1,h2,h3,h4,h5,h6{color:darkblue;font-family:sans-serif;margin:0;border-bottom:1px #eee solid;}
hr{border:1px #eee solid;}
ul,ol{font-family:Hiragino Mincho ProN;}
blockquote{margin:0px;border-left:20px #fff groove; white-space:pre;word-wrap:break-word;}
table{border-left:1px silver solid;border-top:1px silver solid;border-spacing:0;}
th{background:beige;border-right:1px silver solid;border-bottom:1px silver solid;}
td{border-right:1px silver solid;border-bottom:1px silver solid;}
pre{background:beige;padding:10px;white-space:pre;word-wrap:break-word;}
strong{color:red;}
em{background:yellow;}
img{max-width:340px;}
</style>

<textarea id=fire></textarea>
<div id=view style='display:hidden;'></div>

<script>
// view=“https://wineroses.github.io/fire/view.html”;

var flag=0;

fire.value = localStorage.fire || "";
fire.onblur=function(){
  localStorage.fire = fire.value;
}

s=location.search;
if(s) fire.value = fire.value +"\n"+ decodeURIComponent(s.substr(1));

p=0;
clip=0;
document.ontouchstart = function(e){
  p=e.touches[0].pageX;
  clip=1;
  if(e.touches.length>2) Preview();
  
}

document.ontouchmove = function(e){
  x=e.touches[0].pageX;
  d=document.getSelection();
  m=(d.toString().length)? "extend":"move";
  if(x-p>8){
    e.preventDefault();
    if(e.touches.length==2){
      if(clip) document.execCommand('redo');
      clip=0;
    }else{
      d.modify(m,"right","character");
    }
    p=x;
  }
  if(p-x>8){
    e.preventDefault();
    if(e.touches.length==2){
      if(clip) document.execCommand('undo');
      clip=0;
    }else{
      d.modify(m,"left","character");
    }
    p=x;
  }
}

function Preview(){
  localStorage.fire = fire.value;
  if(flag){
    fire.style.display = "block";
    view.style.display = "none";
  }else{
    fire.blur();
    marked.setOptions({breaks:true, langPrefix:""});
    view.innerHTML = marked(fire.value);
    fire.style.display = "none";
    view.style.display = "block";
  }
  flag = 1-flag;
}

</script>
